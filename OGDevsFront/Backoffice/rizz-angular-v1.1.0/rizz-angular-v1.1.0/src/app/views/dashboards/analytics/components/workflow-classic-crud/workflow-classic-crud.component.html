  <div class="container">
    <!-- Workflow Selection -->
    <div class="workflow-selection mb-4">
      <div class="row align-items-center">
        <div class="col-md-6">
          <label for="workflowSelect" class="form-label fw-bold">Select Workflow:</label>
          <select
            id="workflowSelect"
            class="form-select"
            (change)="onWorkflowChange($event)"
            [value]="selectedWorkflow?.id || ''"
          >
            <option value=""> Select a Workflow </option>
            <option *ngFor="let workflow of workflows" [value]="workflow.id">
              {{ workflow.name }} ({{ workflow.processes?.length || 0 }} processes)
            </option>
          </select>
        </div>
        <div class="col-md-6">
          <div class="workflow-info" *ngIf="selectedWorkflow">
            <div class="alert alert-info mb-0">
              <strong>Selected:</strong> {{ selectedWorkflow.name }}<br>
              <small>{{ selectedWorkflow.processes?.length || 0 }} process(es) loaded</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Top toolbar -->
    <div class="top-toolbar">
      <button class="btn btn-success" (click)="openWorkflowNameModal()" title="Save the current workflow">
        <i class="fa-solid fa-save"></i> Save Current Workflow
      </button>
      <button class="btn btn-primary mx-2" (click)="openProcessModal()" title="Add a new process">
        <i class="fa-solid fa-plus"></i> Add Process
      </button>
      <div class="ms-auto">
        <small class="text-muted">
          {{ processes.length }} process(es) |
          {{ objectives.length }} objective(s) |
          {{ operations.length }} operation(s) |
          {{ selectedOperationTasks.length }} task(s)
        </small>
      </div>
    </div>

    <!-- Processes Table -->
    <div class="main-content mt-3">
      <h3>
        Processes
        <span *ngIf="selectedWorkflow" class="text-muted">
          (from workflow: {{ selectedWorkflow.name }})
        </span>
      </h3>

      <div *ngIf="loading" class="loading-spinner">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        Loading processes...
      </div>

      <div *ngIf="!loading && processes.length === 0" class="no-data">
        <div class="alert alert-secondary">
          <i class="fa-solid fa-folder-open"></i>
          No processes found.
          <ng-container *ngIf="selectedWorkflow; else noWorkflowSelected">
            This workflow doesn't contain any processes.
          </ng-container>
          <ng-template #noWorkflowSelected>
            Create a new process or select a workflow.
          </ng-template>
        </div>
      </div>

      <div *ngIf="!loading && processes.length > 0">
        <table class="table table-bordered table-hover">
          <thead class="table-dark">
          <tr>
            <th>Name</th>
            <th>Creation Date</th>
            <th>Modification Date</th>
            <th>Finish Date</th>
            <th>Description</th>
            <th>Pilote</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let process of processes"
              [ngClass]="{'table-active': selectedProcess?.id === process.id}"
              (click)="selectProcess(process)"
              style="cursor: pointer;">
            <td><strong>{{ process.procName }}</strong></td>
            <td>{{ process.creationDate | date:'medium' }}</td>
            <td>{{ process.modifDate | date:'medium' }}</td>
            <td>{{ process.finishDate | date:'medium' }}</td>
            <td>{{ process.description }}</td>
            <td>
              <span class="badge bg-secondary">{{ process.piloteName }}</span>
            </td>
            <td>
              <div class="btn-group" role="group">
                <button class="btn btn-outline-primary btn-sm" (click)="$event.stopPropagation(); openProcessModal(process)" title="Edit process">
                  <i class="fa-solid fa-edit"></i>
                </button>
                <button class="btn btn-outline-danger btn-sm" (click)="$event.stopPropagation(); deleteProcess(process.id!)" title="Delete process">
                  <i class="fa-solid fa-trash"></i>
                </button>
                <button class="btn btn-outline-success btn-sm" (click)="$event.stopPropagation(); openObjectiveModal()" title="Assign objective">
                  <i class="fa-solid fa-bullseye"></i>
                </button>
                <button class="btn btn-outline-info btn-sm" (click)="$event.stopPropagation(); openOperationModal()" title="Assign operation">
                  <i class="fa-solid fa-cogs"></i>
                </button>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Objectives Table -->
    <div class="main-content mt-3" *ngIf="selectedProcess">
      <h4>
        <i class="fa-solid fa-bullseye text-warning"></i>
        Objectives for Process: <span class="text-primary">{{ selectedProcess.procName }}</span>
      </h4>

      <div *ngIf="!loading && objectives.length === 0" class="no-data">
        <div class="alert alert-secondary">
          <i class="fa-solid fa-target"></i>
          No objectives found for this process.
        </div>
      </div>

      <div *ngIf="!loading && objectives.length > 0">
        <table class="table table-bordered table-sm">
          <thead class="table-warning">
          <tr>
            <th>Title</th>
            <th>Axe</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let objective of objectives">
            <td>{{ objective.title }}</td>
            <td>
              <span class="badge bg-warning text-dark">{{ objective.axe }}</span>
            </td>
            <td>
              <div class="btn-group btn-group-sm" role="group">
                <button class="btn btn-outline-primary" (click)="openObjectiveModal(objective)" title="Edit objective">
                  <i class="fa-solid fa-edit"></i>
                </button>
                <button class="btn btn-outline-danger" (click)="deleteObjective(objective.idObjective!)" title="Delete objective">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Operations Table -->
    <div class="main-content mt-3" *ngIf="selectedProcess">
      <h4>
        <i class="fa-solid fa-cogs text-info"></i>
        Operations for Process: <span class="text-primary">{{ selectedProcess.procName }}</span>
      </h4>

      <div *ngIf="!loading && operations.length === 0" class="no-data">
        <div class="alert alert-secondary">
          <i class="fa-solid fa-gear"></i>
          No operations found for this process.
        </div>
      </div>

      <div *ngIf="!loading && operations.length > 0">
        <table class="table table-bordered table-sm">
          <thead class="table-info">
          <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Creation Date</th>
            <th>Finish Date</th>
            <th>Postes Assign√©s</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let operation of operations"
              [ngClass]="{'table-active': selectedOperation?.id === operation.id}"
              (click)="selectOperation(operation)"
              style="cursor: pointer;">
            <td><strong>{{ operation.operationName }}</strong></td>
            <td>{{ operation.operationDescription }}</td>
            <td>{{ operation.creationDate | date:'medium' }}</td>
            <td>{{ operation.finishDate | date:'medium' }}</td>
            <td>
              <!-- üî• AFFICHAGE AM√âLIOR√â DES POSTES -->
              <ng-container *ngIf="getAssignedPostes(operation).length > 0; else noPostes">
                <span class="badge bg-info me-1" *ngFor="let posteName of getAssignedPostes(operation)">
                  <i class="fa-solid fa-briefcase me-1"></i>{{ posteName }}
                </span>
              </ng-container>
              <ng-template #noPostes>
                <span class="text-muted">
                  <i class="fa-solid fa-user-slash me-1"></i>Aucun poste assign√©
                </span>
              </ng-template>
            </td>
            <td>
              <div class="btn-group btn-group-sm" role="group">
                <button class="btn btn-outline-primary" (click)="$event.stopPropagation(); openOperationModal(operation)" title="Edit operation">
                  <i class="fa-solid fa-edit"></i>
                </button>
                <button class="btn btn-outline-danger" (click)="$event.stopPropagation(); deleteOperation(operation.id!)" title="Delete operation">
                  <i class="fa-solid fa-trash"></i>
                </button>
                <button class="btn btn-outline-success" (click)="$event.stopPropagation(); openTaskModal(operation)" title="Assign task">
                  <i class="fa-solid fa-tasks"></i>
                </button>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Tasks Table for Selected Operation -->
    <div class="main-content mt-3" *ngIf="selectedOperation">
      <h4>
        <i class="fa-solid fa-tasks text-success"></i>
        Tasks for Operation: <span class="text-primary">{{ selectedOperation.operationName }}</span>
      </h4>

      <div *ngIf="!loading && selectedOperationTasks.length === 0" class="no-data">
        <div class="alert alert-secondary">
          <i class="fa-solid fa-list-check"></i>
          No tasks found for this operation.
        </div>
      </div>


      <div *ngIf="!loading && selectedOperationTasks.length > 0">
        <table class="table table-bordered table-sm">
          <thead class="table-success">
          <tr>
            <th>Task Name</th>
            <th>Description</th>
            <th>Status</th>
            <th>Priority</th>
            <th>Creation Date</th>
            <th>Finish Date</th>
  <!--          <th>Estimated Time</th>-->
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let task of selectedOperationTasks">
            <td><strong>{{ task.taskDescription }}</strong></td> <!-- Utiliser taskDescription comme nom -->
            <td>{{ task.taskDescription }}</td>
            <td>
              <span class="badge" [ngClass]="getTaskStatusBadgeClass(task.taskStatus)">
                <i class="fa-solid" [ngClass]="getTaskStatusIcon(task.taskStatus)"></i>
                {{ getTaskStatusLabel(task.taskStatus) }}
              </span>
            </td>
            <td>
              <!-- üî• NOUVELLE COLONNE : Priorit√© (pas disponible dans TaskDTO, affichage par d√©faut) -->
              <span class="badge bg-secondary">
                Moyenne
              </span>
            </td>
            <td>{{ task.creationDate | date:'medium' }}</td>
            <td>{{ task.finishDate | date:'medium' }}</td>
  <!--          <td>-->
  <!--            &lt;!&ndash; üî• NOUVELLE COLONNE : Temps estim√© (pas disponible dans TaskDTO, affichage par d√©faut) &ndash;&gt;-->
  <!--            <span class="text-muted">N/A</span>-->
  <!--          </td>-->
            <td>
              <div class="btn-group btn-group-sm" role="group">
                <button class="btn btn-outline-primary"
                        (click)="openTaskModal(selectedOperation!, task)"
                        title="Edit task">
                  <i class="fa-solid fa-edit"></i>
                </button>
                <button class="btn btn-outline-danger"
                        (click)="deleteTask(task.id!)"
                        title="Delete task">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Modal for Workflow Name -->
    <ng-template #workflowNameModal let-modal>
      <div class="modal-header bg-success text-white">
        <h6 class="modal-title m-0">
          <i class="fa-solid fa-save me-2"></i>
          Save Current Workflow
        </h6>
        <button type="button" class="btn-close btn-close-white" (click)="modal.dismiss()" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info">
          <i class="fa-solid fa-info-circle"></i>
          <strong>Information:</strong> This will save all current processes ({{ processes.length }}) into a new workflow.
          <br><small>Make sure you have created at least one process before saving.</small>
        </div>
        <form [formGroup]="workflowNameForm">
          <div class="mb-3">
            <label for="workflowNameInput" class="form-label fw-bold">Workflow Name:</label>
            <input
              type="text"
              formControlName="workflowName"
              class="form-control"
              id="workflowNameInput"
              [ngClass]="{ 'is-invalid': workflowNameForm.get('workflowName')?.invalid && (workflowNameForm.get('workflowName')?.touched || workflowNameForm.get('workflowName')?.dirty) }"
              aria-required="true"
              placeholder="Enter a unique workflow name"
            />
            <div *ngIf="workflowNameForm.get('workflowName')?.errors?.['required']" class="invalid-feedback">
              Workflow name is required.
            </div>
            <div *ngIf="workflowNameForm.get('workflowName')?.errors?.['minlength']" class="invalid-feedback">
              Workflow name must be at least 3 characters long.
            </div>
          </div>
          <div class="text-muted">
            <small>
              <i class="fa-solid fa-lightbulb"></i>
              <strong>Tip:</strong> Choose a descriptive name that reflects the purpose of this workflow.
            </small>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" (click)="submitWorkflowName()" title="Save workflow">
          <i class="fa-solid fa-save me-1"></i>
          Save Workflow
        </button>
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss()" title="Cancel">
          <i class="fa-solid fa-times me-1"></i>
          Cancel
        </button>
      </div>
    </ng-template>

    <!-- Modal for Process -->
    <ng-template #addProcessModal let-modal>
      <div class="modal-header">
        <h6 class="modal-title m-0">{{ processForm.value.id ? 'Edit Process' : 'Add Process' }}</h6>
        <button type="button" class="btn-close" (click)="modal.dismiss()" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="processForm">
          <div class="mb-3 row">
            <label for="processNameInput" class="col-sm-3 col-form-label text-end fw-medium">Process Name:</label>
            <div class="col-sm-9">
              <input
                type="text"
                formControlName="procName"
                class="form-control"
                id="processNameInput"
                [ngClass]="{ 'is-invalid': submitted && processForm.get('procName')?.errors?.['required'] }"
                aria-required="true"
              />
              <div *ngIf="submitted && processForm.get('procName')?.errors?.['required']" class="invalid-feedback">
                Process name is required.
              </div>
            </div>
          </div>
          <div class="mb-3 row">
            <label for="processCreationDateInput" class="col-sm-3 col-form-label text-end fw-medium">Creation Date:</label>
            <div class="col-sm-9">
              <input
                type="date"
                formControlName="creationDate"
                class="form-control"
                id="processCreationDateInput"
                [ngClass]="{ 'is-invalid': submitted && processForm.get('creationDate')?.errors }"
                aria-required="true"
              />
              <div *ngIf="submitted && processForm.get('creationDate')?.errors?.['required']" class="invalid-feedback">
                Creation date is required.
              </div>
              <div *ngIf="submitted && processForm.get('creationDate')?.errors?.['pastOrToday']" class="invalid-feedback">
                Creation date must be today or in the past.
              </div>
            </div>
          </div>
          <div class="mb-3 row">
            <label for="processModifDateInput" class="col-sm-3 col-form-label text-end fw-medium">Modification Date:</label>
            <div class="col-sm-9">
              <input
                type="date"
                formControlName="modifDate"
                class="form-control"
                id="processModifDateInput"
                [ngClass]="{ 'is-invalid': submitted && processForm.get('modifDate')?.errors }"
              />
              <div *ngIf="submitted && processForm.get('modifDate')?.errors?.['pastOrToday']" class="invalid-feedback">
                Modification date must be today or in the past.
              </div>
            </div>
          </div>
          <div class="mb-3 row">
            <label for="processFinishDateInput" class="col-sm-3 col-form-label text-end fw-medium">Finish Date:</label>
            <div class="col-sm-9">
              <input
                type="date"
                formControlName="finishDate"
                class="form-control"
                id="processFinishDateInput"
                [ngClass]="{ 'is-invalid': submitted && processForm.errors?.['invalidDateRange'] }"
              />
              <div *ngIf="submitted && processForm.errors?.['invalidDateRange']" class="invalid-feedback">
                Finish date must be after creation date.
              </div>
            </div>
          </div>
          <div class="mb-3 row">
            <label for="processDescriptionInput" class="col-sm-3 col-form-label text-end fw-medium">Description:</label>
            <div class="col-sm-9">
              <textarea
                formControlName="description"
                class="form-control"
                id="processDescriptionInput"
                rows="2"
                [ngClass]="{ 'is-invalid': submitted && processForm.get('description')?.errors?.['required'] }"
                aria-required="true"
              ></textarea>
              <div *ngIf="submitted && processForm.get('description')?.errors?.['required']" class="invalid-feedback">
                Description is required.
              </div>
            </div>
          </div>
          <div class="mb-3 row">
            <label for="processPiloteInput" class="col-sm-3 col-form-label text-end fw-medium">Pilote:</label>
            <div class="col-sm-9">
              <select
                formControlName="pilote"
                class="form-control"
                id="processPiloteInput"
                [ngClass]="{ 'is-invalid': submitted && processForm.get('pilote')?.errors?.['required'] }"
                aria-required="true"
              >
                <option [ngValue]="null">Select a Pilote</option>
                <option *ngFor="let user of users" [ngValue]="user">
                  {{ user.username }} ({{ user.email }})
                </option>
              </select>
              <div *ngIf="submitted && processForm.get('pilote')?.errors?.['required']" class="invalid-feedback">
                Pilote is required.
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-sm" (click)="saveProcess()" [disabled]="submitted" title="Save process">
          <span *ngIf="submitted" class="spinner-border spinner-border-sm me-2" role="status"></span>
          Save
        </button>
        <button type="button" class="btn btn-outline-danger btn-sm" (click)="modal.dismiss()" title="Close modal">Close</button>
      </div>
    </ng-template>

    <!-- Modal for Objective -->
    <ng-template #addObjectiveModal let-modal>
      <div class="modal-header">
        <h6 class="modal-title m-0">{{ objectiveForm.value?.idObjective ? 'Edit Objective' : 'Add Objective' }}</h6>
        <button type="button" class="btn-close" (click)="modal.dismiss()" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="objectiveForm">
          <div class="mb-3 row">
            <label for="objectiveTitleInput" class="col-sm-3 col-form-label text-end fw-medium">Title:</label>
            <div class="col-sm-9">
              <input
                type="text"
                formControlName="title"
                class="form-control"
                id="objectiveTitleInput"
                [ngClass]="{ 'is-invalid': submitted && objectiveForm.get('title')?.errors?.['required'] }"
                aria-required="true"
              />
              <div *ngIf="submitted && objectiveForm.get('title')?.errors?.['required']" class="invalid-feedback">
                Title is required.
              </div>
            </div>
          </div>
          <div class="mb-3 row">
            <label for="objectiveAxeInput" class="col-sm-3 col-form-label text-end fw-medium">Axe:</label>
            <div class="col-sm-9">
              <select
                formControlName="axe"
                class="form-control"
                id="objectiveAxeInput"
                [ngClass]="{ 'is-invalid': submitted && objectiveForm.get('axe')?.errors?.['required'] }"
                aria-required="true"
              >
                <option value="">Select an Axe</option>
                <option *ngFor="let axe of axes" [value]="axe">{{ axe }}</option>
              </select>
              <div *ngIf="submitted && objectiveForm.get('axe')?.errors?.['required']" class="invalid-feedback">
                Axe is required.
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-sm" (click)="saveObjective()" [disabled]="submitted" title="Save objective">
          <span *ngIf="submitted" class="spinner-border spinner-border-sm me-2" role="status"></span>
          Save
        </button>
        <button type="button" class="btn btn-outline-danger btn-sm" (click)="modal.dismiss()" title="Close modal">Close</button>
      </div>
    </ng-template>

    <!-- Modal for Operation -->
    <ng-template #addOperationModal let-modal>
      <div class="modal-header">
        <h6 class="modal-title m-0">{{ operationForm.value.id ? 'Edit Operation' : 'Add Operation' }}</h6>
        <button type="button" class="btn-close" (click)="modal.dismiss()" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="operationForm">
          <div class="mb-3 row">
            <label for="operationNameInput" class="col-sm-3 col-form-label text-end fw-medium">Operation Name:</label>
            <div class="col-sm-9">
              <input
                type="text"
                formControlName="operationName"
                class="form-control"
                id="operationNameInput"
                [ngClass]="{ 'is-invalid': submitted && operationForm.get('operationName')?.errors?.['required'] }"
                aria-required="true"
              />
              <div *ngIf="submitted && operationForm.get('operationName')?.errors?.['required']" class="invalid-feedback">
                Operation name is required.
              </div>
            </div>
          </div>
          <div class="mb-3 row">
            <label for="operationDescriptionInput" class="col-sm-3 col-form-label text-end fw-medium">Description:</label>
            <div class="col-sm-9">
              <textarea
                formControlName="operationDescription"
                class="form-control"
                id="operationDescriptionInput"
                rows="2"
                [ngClass]="{ 'is-invalid': submitted && operationForm.get('operationDescription')?.errors?.['required'] }"
                aria-required="true"
              ></textarea>
              <div *ngIf="submitted && operationForm.get('operationDescription')?.errors?.['required']" class="invalid-feedback">
                Description is required.
              </div>
            </div>
          </div>
          <div class="mb-3 row">
            <label for="operationCreationDateInput" class="col-sm-3 col-form-label text-end fw-medium">Creation Date:</label>
            <div class="col-sm-9">
              <input
                type="date"
                formControlName="creationDate"
                class="form-control"
                id="operationCreationDateInput"
                [ngClass]="{ 'is-invalid': submitted && operationForm.get('creationDate')?.errors }"
                aria-required="true"
              />
              <div *ngIf="submitted && operationForm.get('creationDate')?.errors?.['required']" class="invalid-feedback">
                Creation date is required.
              </div>
              <div *ngIf="submitted && operationForm.get('creationDate')?.errors?.['pastOrToday']" class="invalid-feedback">
                Creation date must be today or in the past.
              </div>
            </div>
          </div>
          <div class="mb-3 row">
            <label for="operationFinishDateInput" class="col-sm-3 col-form-label text-end fw-medium">Finish Date:</label>
            <div class="col-sm-9">
              <input
                type="date"
                formControlName="finishDate"
                class="form-control"
                id="operationFinishDateInput"
                [ngClass]="{ 'is-invalid': submitted && operationForm.errors?.['invalidDateRange'] }"
              />
              <div *ngIf="submitted && operationForm.errors?.['invalidDateRange']" class="invalid-feedback">
                Finish date must be after creation date.
              </div>
            </div>
          </div>
          <div class="mb-3 row">
            <label for="operationPostesInput" class="col-sm-3 col-form-label text-end fw-medium">
              <i class="fa-solid fa-briefcase me-1"></i>Postes:
            </label>
            <div class="col-sm-9">
              <select
                formControlName="postes"
                class="form-control"
                id="operationPostesInput"
                multiple
                size="4"
                aria-required="true"
              >
                <option *ngFor="let poste of postes" [value]="poste.id">
                  <i class="fa-solid fa-briefcase"></i> {{ poste.mission }}
                  <span class="text-muted">(Salaire: {{ poste.salaire | currency:'EUR':'symbol':'1.0-0' }})</span>
                </option>
              </select>
              <small class="form-text text-muted">
                <i class="fa-solid fa-info-circle me-1"></i>
                Maintenez <kbd>Ctrl</kbd> (ou <kbd>Cmd</kbd> sur Mac) pour s√©lectionner plusieurs postes
              </small>
              <div class="mt-2" *ngIf="operationForm.get('postes')?.value?.length > 0">
                <small class="text-success">
                  <i class="fa-solid fa-check me-1"></i>
                  {{ operationForm.get('postes')?.value?.length }} poste(s) s√©lectionn√©(s)
                </small>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-sm" (click)="saveOperation()" [disabled]="submitted" title="Save operation">
          <span *ngIf="submitted" class="spinner-border spinner-border-sm me-2" role="status"></span>
          Save
        </button>
        <button type="button" class="btn btn-outline-danger btn-sm" (click)="modal.dismiss()" title="Close modal">Close</button>
      </div>
    </ng-template>

    <!-- Modal for Task -->
    <ng-template #addTaskModal let-modal>
      <div class="modal-header">
        <h6 class="modal-title m-0">{{ taskForm.value.id ? 'Edit Task' : 'Add Task' }}</h6>
        <button type="button" class="btn-close" (click)="modal.dismiss()" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="taskForm">
          <!-- Task Name -->
          <div class="mb-3 row">
            <label for="taskNameInput" class="col-sm-3 col-form-label text-end fw-medium">Task Name:</label>
            <div class="col-sm-9">
              <input
                type="text"
                formControlName="taskName"
                class="form-control"
                id="taskNameInput"
                [ngClass]="{ 'is-invalid': submitted && taskForm.get('taskName')?.errors?.['required'] }"
                aria-required="true"
                placeholder="Enter task name"
              />
              <div *ngIf="submitted && taskForm.get('taskName')?.errors?.['required']" class="invalid-feedback">
                Task name is required.
              </div>
            </div>
          </div>

          <div class="mb-3 row">
            <label for="taskDescriptionInput" class="col-sm-3 col-form-label text-end fw-medium">Task Description:</label>
            <div class="col-sm-9">
              <textarea
                formControlName="taskDescription"
                class="form-control"
                id="taskDescriptionInput"
                rows="2"
                [ngClass]="{ 'is-invalid': submitted && taskForm.get('taskDescription')?.errors?.['required'] }"
                aria-required="true"
                placeholder="Enter task description"
              ></textarea>
              <div *ngIf="submitted && taskForm.get('taskDescription')?.errors?.['required']" class="invalid-feedback">
                Task description is required.
              </div>
            </div>
          </div>

          <div class="mb-3 row">
            <label for="taskStatusInput" class="col-sm-3 col-form-label text-end fw-medium">Status:</label>
            <div class="col-sm-9">
              <select
                formControlName="taskStatus"
                class="form-control"
                id="taskStatusInput"
                [ngClass]="{ 'is-invalid': submitted && taskForm.get('taskStatus')?.errors?.['required'] }"
                aria-required="true"
              >
                <option value="TODO">To Do</option>
                <option value="IN_PROGRESS">In Progress</option>
                <option value="DONE">Done</option>
              </select>
              <div *ngIf="submitted && taskForm.get('taskStatus')?.errors?.['required']" class="invalid-feedback">
                Task status is required.
              </div>
            </div>
          </div>

          <div class="mb-3 row">
            <label for="taskCreationDateInput" class="col-sm-3 col-form-label text-end fw-medium">Creation Date:</label>
            <div class="col-sm-9">
              <input
                type="date"
                formControlName="creationDate"
                class="form-control"
                id="taskCreationDateInput"
                [ngClass]="{ 'is-invalid': submitted && taskForm.get('creationDate')?.errors }"
                aria-required="true"
              />
              <div *ngIf="submitted && taskForm.get('creationDate')?.errors?.['required']" class="invalid-feedback">
                Creation date is required.
              </div>
              <div *ngIf="submitted && taskForm.get('creationDate')?.errors?.['pastOrToday']" class="invalid-feedback">
                Creation date must be today or in the past.
              </div>
            </div>
          </div>

          <div class="mb-3 row">
            <label for="taskFinishDateInput" class="col-sm-3 col-form-label text-end fw-medium">Finish Date:</label>
            <div class="col-sm-9">
              <input
                type="date"
                formControlName="finishDate"
                class="form-control"
                id="taskFinishDateInput"
                [ngClass]="{ 'is-invalid': submitted && taskForm.errors?.['invalidDateRange'] }"
              />
              <div *ngIf="submitted && taskForm.errors?.['invalidDateRange']" class="invalid-feedback">
                Finish date must be after creation date.
              </div>
            </div>
          </div>

          <!-- Estimated Time et Priority -->
  <!--        <div class="mb-3 row">-->
  <!--          <label for="taskEstimatedTimeInput" class="col-sm-3 col-form-label text-end fw-medium">Estimated Time (hours):</label>-->
  <!--          <div class="col-sm-9">-->
  <!--            <input-->
  <!--              type="number"-->
  <!--              formControlName="estimatedTime"-->
  <!--              class="form-control"-->
  <!--              id="taskEstimatedTimeInput"-->
  <!--              min="0"-->
  <!--              placeholder="0"-->
  <!--            />-->
  <!--          </div>-->
  <!--        </div>-->

          <div class="mb-3 row">
            <label for="taskPriorityInput" class="col-sm-3 col-form-label text-end fw-medium">Priority:</label>
            <div class="col-sm-9">
              <select
                formControlName="priority"
                class="form-control"
                id="taskPriorityInput"
              >
                <option value="LOW">Low</option>
                <option value="MEDIUM">Medium</option>
                <option value="HIGH">High</option>
                <option value="URGENT">Urgent</option>
              </select>
            </div>
          </div>

          <div class="mb-3 row">
            <label for="taskDataIdsInput" class="col-sm-3 col-form-label text-end fw-medium">Data:</label>
            <div class="col-sm-9">
              <select
                formControlName="dataIds"
                class="form-control"
                id="taskDataIdsInput"
                multiple
                aria-required="true"
              >
                <option *ngFor="let data of dataList" [value]="data.id">
                  {{ data.content }} ({{ data.datatype }} - {{ data.registrationDate | date:'medium' }})
                </option>
              </select>
              <small class="form-text text-muted">
                Maintenez Ctrl (ou Cmd sur Mac) pour s√©lectionner plusieurs donn√©es
              </small>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-sm" (click)="saveTask()" [disabled]="submitted" title="Save task">
          <span *ngIf="submitted" class="spinner-border spinner-border-sm me-2" role="status"></span>
          Save
        </button>
        <button type="button" class="btn btn-outline-danger btn-sm" (click)="modal.dismiss()" title="Close modal">Close</button>
      </div>
    </ng-template>
  </div>
