<div class="face-capture-container" [@fadeInOut]="isCapturing || isProcessing ? 'in' : 'out'">
  <h4>Vérification de l'identité</h4>

  <!-- Instructions pour l'utilisateur -->
  <div class="instructions" *ngIf="isCapturing && !isProcessing && !capturedImage">
    <p>Positionnez votre visage dans le cercle et regardez la caméra.</p>
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
    <button class="btn btn-primary" (click)="retryCamera()">Réessayer</button>
  </div>

  <!-- Vidéo de la webcam avec overlay -->
  <div class="video-container" [ngClass]="{'hidden': !isCapturing || isProcessing}">
    <video #videoElement autoplay playsinline muted></video>
    <canvas #overlayCanvas class="overlay-canvas" [width]="videoWidth" [height]="videoHeight"></canvas>
    <canvas #canvasElement style="display: none;"></canvas>
  </div>

  <!-- Prévisualisation de l'image capturée -->
  <div *ngIf="capturedImage" class="preview-container">
    <img [src]="capturedImage" alt="Image capturée" style="max-width: 640px;" />
    <div class="preview-actions">
      <button class="btn btn-primary" (click)="verifyFace()">Envoyer pour vérification</button>
      <button class="btn btn-secondary" (click)="retryCapture()">Recapturer</button>
    </div>
  </div>

  <!-- Indicateur de traitement -->
  <div *ngIf="isProcessing" class="processing">
    <p>Vérification en cours...</p>
  </div>

  <!-- Boutons -->
  <div class="actions" *ngIf="isCapturing && !isProcessing && !capturedImage">
    <button class="btn btn-primary" (click)="captureImage()">Capturer l'image</button>
    <button class="btn btn-secondary" (click)="stopCamera()">Annuler</button>
  </div>
</div>
<style>
  .face-capture-container {
    text-align: center;
    padding: 20px;
  }

  .video-container {
    position: relative;
    margin: 0 auto; /* Centrer le conteneur */
    width: 640px; /* Largeur fixe pour la vidéo */
    height: 480px; /* Hauteur fixe pour la vidéo */
    overflow: hidden; /* Éviter les débordements */
  }

  video {
    width: 100%;
    height: 100%;
    object-fit: cover; /* S'assurer que la vidéo remplit le conteneur sans déformation */
    object-position: center; /* Centrer l'image de la caméra */
    border: 1px solid #ccc;
    border-radius: 4px;
  }

  .overlay-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }

  .preview-container {
    margin-top: 20px;
  }

  .preview-actions {
    margin-top: 10px;
    display: flex;
    gap: 10px;
    justify-content: center;
  }

  .processing {
    margin-top: 20px;
  }

  .actions {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 10px;
  }

  .hidden {
    display: none;
  }

  .error-message {
    color: #dc3545;
    font-size: 0.875rem;
  }

  .instructions {
    margin-bottom: 10px;
    font-size: 0.9rem;
    color: #666;
  }

  .btn {
    padding: 8px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
  }

  .btn-primary {
    background-color: #0078d7;
    color: white;
  }

  .btn-primary:hover {
    background-color: #0066b3;
  }

  .btn-secondary {
    background-color: #6c757d;
    color: white;
  }

  .btn-secondary:hover {
    background-color: #5a6268;
  }
</style>
