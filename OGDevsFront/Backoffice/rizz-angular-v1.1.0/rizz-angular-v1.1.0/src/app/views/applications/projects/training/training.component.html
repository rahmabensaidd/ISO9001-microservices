<div class="container mt-5">
  <!-- Google Calendar Synchronization -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-warning text-dark">
      <h2 class="mb-0">Synchronization with Google Calendar</h2>
    </div>
    <div class="card-body text-center">
      <p *ngIf="googleAccessToken" class="text-success mb-3">Connected to Google Calendar!</p>
      <asl-google-signin-button type="standard" size="large"></asl-google-signin-button>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

  <!-- Calendar -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-success text-white">
      <h2 class="mb-0">Training Calendar</h2>
    </div>
    <div class="card-body">
      <full-calendar [options]="calendarOptions"></full-calendar>
    </div>
  </div>

  <div class="row">
    <!-- Training List -->
    <div class="col-lg-8">
      <div class="card">
        <div class="card-body">
          <h4 class="card-title mb-4">Training List</h4>
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
              <tr>
                <th>Name</th>
                <th>Scheduled Date</th>
                <th>Duration</th>
                <th>Completion Rate</th>
                <th>Actions</th>
              </tr>
              </thead>
              <tbody>
                @for (training of trainings; track training.trainingId) {
                  <tr>
                    <td>{{ training.trainingName }}</td>
                    <td>{{ training.scheduledDate }}</td>
                    <td>{{ training.duration }} hours</td>
                    <td>{{ training.completionRate }}%</td>
                    <td>
                      <button class="btn btn-primary btn-sm me-2" (click)="editTraining(training)">
                        <i class="las la-edit"></i> Edit
                      </button>
                      <button class="btn btn-danger btn-sm" (click)="deleteTraining(training.trainingId!)">
                        <i class="las la-trash-alt"></i> Delete
                      </button>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Form -->
    <div class="col-lg-4">
      <div class="card">
        <div class="card-body">
          <h4 class="card-title mb-4">{{ isEditing ? 'Edit Training' : 'Add Training' }}</h4>
          <form [formGroup]="trainingForm" (ngSubmit)="isEditing ? updateTraining() : createTraining()">
            <div class="form-group mb-3">
              <label for="trainingName" class="form-label">Training Name</label>
              <input type="text" class="form-control" id="trainingName" formControlName="trainingName" placeholder="Training name" />
              <div *ngIf="f['trainingName'].touched && f['trainingName'].errors" class="text-danger">
                <div *ngIf="f['trainingName'].errors['required']">Name is required.</div>
                <div *ngIf="f['trainingName'].errors['minlength']">Name must be at least 3 characters long.</div>
              </div>
            </div>
            <div class="form-group mb-3">
              <label for="scheduledDate" class="form-label">Scheduled Date</label>
              <input type="datetime-local" class="form-control" id="scheduledDate" formControlName="scheduledDate" />
              <div *ngIf="f['scheduledDate'].touched && f['scheduledDate'].errors" class="text-danger">
                <div *ngIf="f['scheduledDate'].errors['required']">Date is required.</div>
              </div>
            </div>
            <div class="form-group mb-3">
              <label for="duration" class="form-label">Duration (hours)</label>
              <input type="number" class="form-control" id="duration" formControlName="duration" placeholder="Duration in hours" />
              <div *ngIf="f['duration'].touched && f['duration'].errors" class="text-danger">
                <div *ngIf="f['duration'].errors['required']">Duration is required.</div>
                <div *ngIf="f['duration'].errors['min']">Duration must be greater than 0.</div>
              </div>
            </div>
            <div class="form-group mb-3">
              <label for="completionRate" class="form-label">Completion Rate (%)</label>
              <input type="number" class="form-control" id="completionRate" formControlName="completionRate" placeholder="Completion rate" />
              <div *ngIf="f['completionRate'].touched && f['completionRate'].errors" class="text-danger">
                <div *ngIf="f['completionRate'].errors['required']">Completion rate is required.</div>
                <div *ngIf="f['completionRate'].errors['min']">Completion rate must be at least 0.</div>
                <div *ngIf="f['completionRate'].errors['max']">Completion rate cannot exceed 100.</div>
              </div>
            </div>
            <button type="submit" class="btn btn-primary me-0.5" [disabled]="trainingForm.invalid">
              {{ isEditing ? 'Update' : 'Add' }}
            </button>
            <button type="button" class="btn btn-danger" (click)="resetForm()">
              {{ isEditing ? 'Cancel' : 'Cancel' }}
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
