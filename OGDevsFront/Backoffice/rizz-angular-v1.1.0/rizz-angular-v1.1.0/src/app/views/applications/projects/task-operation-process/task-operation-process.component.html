<div class="row justify-content-center">
  <div class="col-12">
    <!-- List Mode -->
    @if (mode === 'list') {
      <!-- Tasks Table -->
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">Tasks</h4>
        </div>
        <div class="card-body pt-0">
          <div class="table-responsive">
            <table class="table datatable">
              <thead class="table-light">
              <tr>

                <th scope="col">Description</th>
                <th scope="col">Status</th>
                <th scope="col">Operation</th>
                <!-- Removed Assigned Users column -->
              </tr>
              </thead>
              <tbody>
                @for (task of filteredTasks; track task.id; let i = $index) {
                  <tr>

                    <td>{{ task.taskDescription ?? 'No description' }}</td>
                    <td>{{ task.taskStatus ?? 'Unknown' }}</td>
                    <td>{{ task.operation?.operationName ?? task.operationName ?? 'None' }}</td>
                    <!-- Removed Assigned Users column -->
                  </tr>
                }
                @if (filteredTasks.length === 0) {
                  <tr>
                    <td colspan="4" style="text-align: center">No tasks found</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Operations Table -->
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">Operations</h4>
        </div>
        <div class="card-body pt-0">
          <div class="table-responsive">
            <table class="table datatable">
              <thead class="table-light">
              <tr>

                <th scope="col">Name</th>
                <th scope="col">Description</th>
                <th scope="col">Process</th>
                <th scope="col">Tasks</th>
                <!-- Removed Assigned Users column -->
              </tr>
              </thead>
              <tbody>
                @for (operation of filteredOperations; track operation.id; let i = $index) {
                  <tr>

                    <td>{{ operation.operationName ?? 'No name' }}</td>
                    <td>{{ operation.operationDescription ?? 'No description' }}</td>
                    <td>{{ operation.process?.procName ?? operation.processName ?? 'None' }}</td>
                    <td>
                      {{ getTaskDescriptions(operation) }}
                    </td>
                    <!-- Removed Assigned Users column -->
                  </tr>
                }
                @if (filteredOperations.length === 0) {
                  <tr>
                    <td colspan="5" style="text-align: center">No operations found</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Processes Table -->
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">Processes</h4>
        </div>
        <div class="card-body pt-0">
          <div class="table-responsive">
            <table class="table datatable">
              <thead class="table-light">
              <tr>

                <th scope="col">Name</th>
                <th scope="col">Description</th>
                <th scope="col">Creation Date</th>
                <th scope="col">Pilote</th>
              </tr>
              </thead>
              <tbody>
                @for (process of filteredProcesses; track process.id; let i = $index) {
                  <tr>

                    <td>{{ process.procName ?? 'No name' }}</td>
                    <td>{{ process.description ?? 'No description' }}</td>
                    <td>{{ formatCreationDate(process.creationDate) ?? 'Unknown date' }}</td>
                    <td>
                      @if (process.pilote) {
                        {{ process.pilote.username ?? process.piloteName ?? 'None' }} (ID: {{ process.pilote.id ?? process.piloteId ?? 'N/A' }})
                      } @else {
                        {{ process.piloteName ?? 'None' }}
                      }
                    </td>
                  </tr>
                }
                @if (filteredProcesses.length === 0) {
                  <tr>
                    <td colspan="5" style="text-align: center">No processes found</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>
    }

    <!-- Details Mode -->
    @if (mode === 'details' && selectedEntity) {
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">{{ entityType }} Details</h4>
        </div>
        <div class="card-body">
          @switch (entityType) {
            @case ('Task') {
              @if (isTask(selectedEntity)) {
                <p><strong>Description:</strong> {{ selectedEntity.taskDescription ?? 'No description' }}</p>
                <p><strong>Status:</strong> {{ selectedEntity.taskStatus ?? 'Unknown' }}</p>
                <p><strong>Operation:</strong> {{ selectedEntity.operation?.operationName ?? selectedEntity.operationName ?? 'None' }}</p>
              }
            }
            @case ('Operation') {
              @if (isOperation(selectedEntity)) {
                <p><strong>Name:</strong> {{ selectedEntity.operationName ?? 'No name' }}</p>
                <p><strong>Description:</strong> {{ selectedEntity.operationDescription ?? 'No description' }}</p>
                <p><strong>Process:</strong> {{ selectedEntity.process?.procName ?? selectedEntity.processName ?? 'None' }}</p>
                <p>
                  <strong>Tasks:</strong>
                  @if (getTaskDescriptions(selectedEntity) !== 'None') {
                    {{ getTaskDescriptions(selectedEntity) }}
                  } @else {
                    None
                  }
                </p>
              }
            }
            @case ('Process') {
              @if (isProcess(selectedEntity)) {
                <p><strong>Name:</strong> {{ selectedEntity.procName ?? 'No name' }}</p>
                <p><strong>Description:</strong> {{ selectedEntity.description ?? 'No description' }}</p>
                <p><strong>Creation Date:</strong> {{ formatCreationDate(selectedEntity.creationDate) ?? 'Unknown date' }}</p>
                <p>
                  <strong>Pilote:</strong>
                  @if (selectedEntity.pilote) {
                    {{ selectedEntity.pilote.username ?? selectedEntity.piloteName ?? 'None' }}
                  } @else {
                    {{ selectedEntity.piloteName ?? 'None' }}
                  }
                </p>
              }
            }
            @default {
              <p>Invalid entity type</p>
            }
          }
        </div>
      </div>
    }

    <!-- Loading or Error State -->
    @if (mode === 'details' && !selectedEntity) {
      <div class="card">
        <div class="card-body">
          <p>Loading details or entity not found...</p>
        </div>
      </div>
    }
  </div>
</div>

