<app-header-front></app-header-front>

<!-- Main Content Section -->
<main class="container my-5" style="min-height: 70vh;">
  <!-- Job Offers Section (shown only on /job-offers route) -->
  <div *ngIf="isJobOffersRoute">
    <div class="row">
      <!-- Job Offers Section -->
      <div class="col-lg-12 col-md-12">
        <!-- Filter Sidebar -->
        <div class="mb-4">
          <div class="card shadow-lg border-0 p-4 filter-card">
            <h5 class="text-primary mb-4"><i class="bi bi-funnel me-2"></i>Filter Job Offers</h5>
            <form [formGroup]="filterForm">
              <!-- Horizontal Filter Inputs -->
              <div class="row mb-3">
                <!-- Job Title -->
                <div class="col-md-4 mb-3">
                  <label for="title" class="form-label"><i class="bi bi-search me-2 text-primary"></i>Job Title</label>
                  <input type="text" id="title" formControlName="title" class="form-control" placeholder="e.g., Software Engineer">
                </div>
                <!-- Contract Type -->
                <div class="col-md-4 mb-3">
                  <label for="contractType" class="form-label"><i class="bi bi-briefcase me-2 text-primary"></i>Contract Type</label>
                  <select id="contractType" formControlName="contractType" class="form-control">
                    <option value="">All</option>
                    <option value="CDI">CDI</option>
                    <option value="CDD">CDD</option>
                    <option value="CVP">CVP</option>
                    <option value="FREELANCE">Freelance</option>
                    <option value="INTERIM">Interim</option>
                  </select>
                </div>
                <!-- Salary Range -->
                <div class="col-md-4 mb-3">
                  <label class="form-label"><i class="bi bi-currency-euro me-2 text-primary"></i>Salary</label>
                  <div class="row">
                    <div class="col">
                      <input type="number" formControlName="salaryMin" class="form-control" placeholder="Min (€)">
                    </div>
                    <div class="col">
                      <input type="number" formControlName="salaryMax" class="form-control" placeholder="Max (€)">
                    </div>
                  </div>
                </div>
              </div>
              <!-- Reset Button -->
              <div class="row">
                <div class="col-12">
                  <button type="button" class="btn btn-outline-secondary w-100" (click)="resetFilters()">
                    <i class="bi bi-arrow-counterclockwise me-2"></i>Reset Filters
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- Generate CV Button -->
        <div class="text-center mb-4">
          <button class="btn btn-success" (click)="showGenerateCVModal = true" aria-label="Generate a CV">
            <i class="bi bi-file-earmark-pdf me-2"></i>Generate a Professional CV
          </button>
        </div>

        <!-- Title -->
        <h1 class="text-center mb-5 display-4 fw-bold text-primary" data-aos="fade-up" style="font-family: 'Inter', sans-serif;">
          List of Job Offers
        </h1>

        <!-- Error Message -->
        <div *ngIf="errorMessage" class="alert alert-danger text-center rounded-3 shadow-sm" role="alert" data-aos="fade-up" data-aos-delay="100" style="font-family: 'Nunito', sans-serif; border: 1px solid #dc3545;">
          {{ errorMessage }}
        </div>

        <!-- Job Offers List -->
        <div class="row g-4">
          <div *ngFor="let offer of filteredJobOffers" class="col-md-4 mb-4">
            <div class="card h-100 shadow-lg border-0 job-card" (click)="showJobDetails(offer)" data-aos="fade-up">
              <div class="card-body p-4">
                <!-- Company Logo Placeholder -->
                <div class="company-logo mb-3">
                  <img *ngIf="offer.companyLogo" [src]="offer.companyLogo" alt="Company Logo" class="img-fluid rounded-circle" style="width: 40px; height: 40px;">
                  <span *ngIf="!offer.companyLogo" class="text-muted">{{ offer.title.charAt(0) }}</span>
                </div>
                <h5 class="card-title text-dark fw-semibold mb-2 job-title">{{ offer.title }}</h5>
                <p class="card-text text-muted mb-1" style="font-size: 0.9rem;">
                  <i class="bi bi-geo-alt-fill me-2 text-primary"></i>{{ offer.location }}
                </p>
                <p class="card-text text-muted mb-1" style="font-size: 0.9rem;">
                  <i class="bi bi-briefcase-fill me-2 text-primary"></i>{{ offer.contractType }}
                </p>
                <p class="card-text text-muted mb-3" style="font-size: 0.9rem;">
                  <i class="bi bi-house-door-fill me-2 text-primary"></i>{{ offer.workType }}
                </p>
                <p class="card-text text-muted mb-3" style="font-size: 0.9rem;">
                  <i class="bi bi-currency-euro me-2 text-primary"></i>{{ offer.salary | currency:'EUR' }}
                </p>
                <button class="btn btn-primary btn-sm w-100" (click)="onApply(offer.id!); $event.stopPropagation()" [attr.aria-label]="'Apply to ' + offer.title">
                  <i class="bi bi-send me-2"></i>Apply
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- No Offers Available -->
        <div *ngIf="filteredJobOffers.length === 0 && !errorMessage" class="text-center py-5" data-aos="fade-up" data-aos-delay="300">
          <p class="text-muted fs-5" style="font-family: 'Nunito', sans-serif; color: #6c757d;">No job offers match your criteria.</p>
          <i class="bi bi-emoji-frown" style="font-size: 3rem; color: #6c757d;"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Placeholder for Other Routes -->
  <router-outlet></router-outlet>
</main>

<!-- Job Details Modal -->
<div class="modal" tabindex="-1" [class.show]="showJobDetailsModal" [style.display]="showJobDetailsModal ? 'block' : 'none'" style="background-color: rgba(0, 0, 0, 0.5);">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ selectedOffer?.title }}</h5>
        <button type="button" class="btn-close" (click)="showJobDetailsModal = false" aria-label="Close"></button>
      </div>
      <div class="modal-body" *ngIf="selectedOffer">
        <div class="row">
          <div class="col-md-8">
            <h6 class="text-muted"><i class="bi bi-file-text me-2 text-primary"></i>Description</h6>
            <p>{{ selectedOffer.description }}</p>
            <h6 class="text-muted mt-3"><i class="bi bi-check-circle me-2 text-primary"></i>Requirements</h6>
            <p>{{ selectedOffer.requirements }}</p>
            <h6 class="text-muted mt-3"><i class="bi bi-gear me-2 text-primary"></i>Skills and Expertise</h6>
            <p>{{ selectedOffer.skillsAndExpertise }}</p>
          </div>
          <div class="col-md-4">
            <h6 class="text-muted"><i class="bi bi-info-circle me-2 text-primary"></i>Details</h6>
            <p><i class="bi bi-geo-alt-fill me-2 text-primary"></i><strong>Location:</strong> {{ selectedOffer.location }}</p>
            <p><i class="bi bi-briefcase-fill me-2 text-primary"></i><strong>Contract Type:</strong> {{ selectedOffer.contractType }}</p>
            <p><i class="bi bi-house-door-fill me-2 text-primary"></i><strong>Work Type:</strong> {{ selectedOffer.workType }}</p>
            <p><i class="bi bi-currency-euro me-2 text-primary"></i><strong>Salary:</strong> {{ selectedOffer.salary | currency:'EUR' }}</p>
          </div>
        </div>
        <button class="btn btn-primary mt-3" (click)="onApply(selectedOffer.id!)" [attr.aria-label]="'Apply to ' + selectedOffer.title">
          <i class="bi bi-send me-2"></i>Apply
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Candidate Application Form Modal -->
<div class="modal" tabindex="-1" [class.show]="showApplicationForm" [style.display]="showApplicationForm ? 'block' : 'none'" style="background-color: rgba(0, 0, 0, 0.5);">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Application for Job Offer</h5>
        <button type="button" class="btn-close" (click)="showApplicationForm = false" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="candidateForm" (ngSubmit)="createCandidate()">
          <div class="mb-3">
            <label for="firstName" class="form-label"><i class="bi bi-person me-2 text-primary"></i>First Name</label>
            <input type="text" id="firstName" formControlName="firstName" class="form-control" placeholder="First Name">
            <div *ngIf="f['firstName'].touched && f['firstName'].errors" class="text-danger">
              <div *ngIf="f['firstName'].errors['required']">First name is required.</div>
              <div *ngIf="f['firstName'].errors['minlength']">First name must be at least 2 characters long.</div>
            </div>
          </div>
          <div class="mb-3">
            <label for="lastName" class="form-label"><i class="bi bi-person me-2 text-primary"></i>Last Name</label>
            <input type="text" id="lastName" formControlName="lastName" class="form-control" placeholder="Last Name">
            <div *ngIf="f['lastName'].touched && f['lastName'].errors" class="text-danger">
              <div *ngIf="f['lastName'].errors['required']">Last name is required.</div>
              <div *ngIf="f['lastName'].errors['minlength']">Last name must be at least 2 characters long.</div>
            </div>
          </div>
          <div class="mb-3">
            <label for="email" class="form-label"><i class="bi bi-envelope me-2 text-primary"></i>Email</label>
            <input type="email" id="email" formControlName="email" class="form-control" placeholder="Email">
            <div *ngIf="f['email'].touched && f['email'].errors" class="text-danger">
              <div *ngIf="f['email'].errors['required']">Email is required.</div>
              <div *ngIf="f['email'].errors['email']">Please enter a valid email address.</div>
            </div>
          </div>
          <div class="mb-3">
            <label for="resume" class="form-label"><i class="bi bi-file-earmark-pdf me-2 text-primary"></i>Resume (PDF only)</label>
            <input type="file" id="resume" (change)="onFileChange($event)" accept=".pdf" class="form-control">
            <div *ngIf="f['resume'].touched && f['resume'].errors" class="text-danger">
              <div *ngIf="f['resume'].errors['required']">Resume is required.</div>
            </div>
          </div>
          <div class="mb-3">
            <label for="gender" class="form-label"><i class="bi bi-gender-ambiguous me-2 text-primary"></i>Gender</label>
            <select id="gender" formControlName="gender" class="form-control">
              <option value="">Select your gender</option>
              <option value="M">Male</option>
              <option value="F">Female</option>
              <option value="O">Other</option>
            </select>
            <div *ngIf="f['gender'].touched && f['gender'].errors" class="text-danger">
              <div *ngIf="f['gender'].errors['required']">Gender is required.</div>
            </div>
          </div>
          <div class="d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-secondary" (click)="showApplicationForm = false">Cancel</button>
            <button type="submit" class="btn btn-primary" [disabled]="candidateForm.invalid">
              <i class="bi bi-send me-2"></i>Submit
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Generate CV Modal -->
<div class="modal" tabindex="-1" [class.show]="showGenerateCVModal" [style.display]="showGenerateCVModal ? 'block' : 'none'" style="background-color: rgba(0, 0, 0, 0.5);">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Generate a Professional CV</h5>
        <button type="button" class="btn-close" (click)="showGenerateCVModal = false" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="resumeForm" (ngSubmit)="generateCV()">
          <!-- Section: Personal Information -->
          <h6 class="text-primary mb-3"><i class="bi bi-person-circle me-2"></i>Personal Information</h6>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="fullName" class="form-label"><i class="bi bi-person me-2 text-primary"></i>Full Name</label>
              <input type="text" id="fullName" formControlName="fullName" class="form-control" placeholder="Full Name">
              <div *ngIf="r['fullName'].touched && r['fullName'].errors" class="text-danger">
                <div *ngIf="r['fullName'].errors['required']">Full name is required.</div>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="email" class="form-label"><i class="bi bi-envelope me-2 text-primary"></i>Email</label>
              <input type="email" id="email" formControlName="email" class="form-control" placeholder="Email">
              <div *ngIf="r['email'].touched && r['email'].errors" class="text-danger">
                <div *ngIf="r['email'].errors['required']">Email is required.</div>
                <div *ngIf="r['email'].errors['email']">Please enter a valid email address.</div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="phone" class="form-label"><i class="bi bi-telephone me-2 text-primary"></i>Phone</label>
              <input type="text" id="phone" formControlName="phone" class="form-control" placeholder="Phone">
            </div>
            <div class="col-md-6 mb-3">
              <label for="address" class="form-label"><i class="bi bi-geo-alt me-2 text-primary"></i>Address</label>
              <input type="text" id="address" formControlName="address" class="form-control" placeholder="Address">
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="linkedIn" class="form-label"><i class="bi bi-linkedin me-2 text-primary"></i>LinkedIn (URL)</label>
              <input type="url" id="linkedIn" formControlName="linkedIn" class="form-control" placeholder="https://www.linkedin.com/in/yourprofile">
              <div *ngIf="r['linkedIn'].touched && r['linkedIn'].errors" class="text-danger">
                <div *ngIf="r['linkedIn'].errors['pattern']">Please enter a valid LinkedIn URL.</div>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="photo" class="form-label"><i class="bi bi-camera me-2 text-primary"></i>Photo (JPG/PNG)</label>
              <input type="file" id="photo" (change)="onPhotoUpload($event)" accept="image/jpeg,image/png" class="form-control">
              <small class="text-muted">Recommended size: 100x100px</small>
            </div>
          </div>

          <!-- Section: Professional Profile -->
          <h6 class="text-primary mb-3 mt-4"><i class="bi bi-person-lines-fill me-2"></i>Professional Profile</h6>
          <div class="mb-3">
            <label for="professionalProfile" class="form-label">Professional Profile Summary</label>
            <textarea id="professionalProfile" formControlName="professionalProfile" class="form-control" rows="6" placeholder="Example: Results-driven software developer with 5 years of experience."></textarea>
          </div>

          <!-- Section: Education -->
          <h6 class="text-primary mb-3 mt-4"><i class="bi bi-book me-2"></i>Education</h6>
          <div formArrayName="educations">
            <div *ngFor="let edu of educations.controls; let i=index" [formGroupName]="i" class="mb-3">
              <div class="row">
                <div class="col-md-6 mb-2">
                  <label [for]="'startDate' + i" class="form-label">Start Date</label>
                  <input type="date" [id]="'startDate' + i" formControlName="startDate" class="form-control">
                </div>
                <div class="col-md-6 mb-2">
                  <label [for]="'endDate' + i" class="form-label">End Date</label>
                  <input type="date" [id]="'endDate' + i" formControlName="endDate" class="form-control">
                </div>
              </div>
              <div class="mb-2">
                <label [for]="'description' + i" class="form-label">Education Description</label>
                <textarea [id]="'description' + i" formControlName="description" class="form-control" rows="4" placeholder="Example: 2020-2023, Master's in Computer Science"></textarea>
              </div>
              <button type="button" class="btn btn-danger btn-sm" (click)="removeEducation(i)">Remove</button>
            </div>
            <button type="button" class="btn btn-outline-primary btn-sm mt-2" (click)="addEducation()">Add Education</button>
          </div>

          <!-- Section: Experience -->
          <h6 class="text-primary mb-3 mt-4"><i class="bi bi-briefcase me-2"></i>Professional Experience</h6>
          <div formArrayName="experiences">
            <div *ngFor="let exp of experiences.controls; let i=index" [formGroupName]="i" class="mb-3">
              <div class="row">
                <div class="col-md-6 mb-2">
                  <label [for]="'startDate' + i" class="form-label">Start Date</label>
                  <input type="date" [id]="'startDate' + i" formControlName="startDate" class="form-control">
                </div>
                <div class="col-md-6 mb-2">
                  <label [for]="'endDate' + i" class="form-label">End Date</label>
                  <input type="date" [id]="'endDate' + i" formControlName="endDate" class="form-control">
                </div>
              </div>
              <div class="mb-2">
                <label [for]="'description' + i" class="form-label">Experience Description</label>
                <textarea [id]="'description' + i" formControlName="description" class="form-control" rows="6" placeholder="Example: 2021-2023, Web Developer"></textarea>
              </div>
              <button type="button" class="btn btn-danger btn-sm" (click)="removeExperience(i)">Remove</button>
            </div>
            <button type="button" class="btn btn-outline-primary btn-sm mt-2" (click)="addExperience()">Add Experience</button>
          </div>

          <!-- Section: Technical Skills -->
          <h6 class="text-primary mb-3 mt-4"><i class="bi bi-gear me-2"></i>Technical Skills</h6>
          <div formArrayName="technicalSkills">
            <div *ngFor="let skill of technicalSkills.controls; let i=index" [formGroupName]="i" class="row mb-2">
              <div class="col-md-6">
                <input type="text" formControlName="name" class="form-control" placeholder="Skill (e.g., HTML)">
              </div>
              <div class="col-md-4">
                <select formControlName="level" class="form-control">
                  <option value="100">Expert (100%)</option>
                  <option value="80">Advanced (80%)</option>
                  <option value="60">Intermediate (60%)</option>
                  <option value="40">Beginner (40%)</option>
                </select>
              </div>
              <div class="col-md-2">
                <button type="button" class="btn btn-danger btn-sm" (click)="removeTechnicalSkill(i)">Remove</button>
              </div>
            </div>
            <button type="button" class="btn btn-outline-primary btn-sm mt-2" (click)="addTechnicalSkill()">Add Skill</button>
          </div>

          <!-- Section: Languages -->
          <h6 class="text-primary mb-3 mt-4"><i class="bi bi-globe me-2"></i>Languages</h6>
          <div formArrayName="languages">
            <div *ngFor="let lang of languages.controls; let i=index" [formGroupName]="i" class="row mb-2">
              <div class="col-md-6">
                <input type="text" formControlName="name" class="form-control" placeholder="Language (e.g., English)">
              </div>
              <div class="col-md-4">
                <select formControlName="level" class="form-control">
                  <option value="Advanced">Advanced</option>
                  <option value="Intermediate">Intermediate</option>
                  <option value="Beginner">Beginner</option>
                </select>
              </div>
              <div class="col-md-2">
                <button type="button" class="btn btn-danger btn-sm" (click)="removeLanguage(i)">Remove</button>
              </div>
            </div>
            <button type="button" class="btn btn-outline-primary btn-sm mt-2" (click)="addLanguage()">Add Language</button>
          </div>

          <!-- Section: Interests -->
          <h6 class="text-primary mb-3 mt-4"><i class="bi bi-heart me-2"></i>Interests</h6>
          <div class="mb-3">
            <label for="interests" class="form-label">Your Interests</label>
            <textarea id="interests" formControlName="interests" class="form-control" rows="2" placeholder="Example: Reading, Football, Travel"></textarea>
          </div>

          <!-- Section: CV Style -->
          <h6 class="text-primary mb-3 mt-4"><i class="bi bi-palette me-2"></i>CV Style</h6>
          <div class="mb-3">
            <label for="templateStyle" class="form-label">Choose a Style</label>
            <select id="templateStyle" formControlName="templateStyle" class="form-control">
              <option value="modern">Modern</option>
              <option value="classic">Classic</option>
              <option value="creative">Creative</option>
            </select>
          </div>

          <!-- Buttons -->
          <div class="d-flex justify-content-end gap-2 mt-4">
            <button type="button" class="btn btn-secondary" (click)="showGenerateCVModal = false">Cancel</button>
            <button type="submit" class="btn btn-primary" [disabled]="resumeForm.invalid">
              <i class="bi bi-file-earmark-pdf me-2"></i>Generate PDF
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<app-footer-front></app-footer-front>

<!-- Vendor JS Files -->
<script src="/assets/FrontOffice/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/assets/FrontOffice/assets/vendor/php-email-form/validate.js"></script>
<script src="/assets/FrontOffice/assets/vendor/aos/aos.js"></script>
<script src="/assets/FrontOffice/assets/vendor/glightbox/js/glightbox.min.js"></script>
<script src="/assets/FrontOffice/assets/vendor/swiper/swiper-bundle.min.js"></script>
<script src="/assets/FrontOffice/assets/vendor/purecounter/purecounter_vanilla.js"></script>

<!-- Main JS File -->
<script src="/assets/FrontOffice/assets/js/main.js"></script>

<!-- Initialize AOS -->
<script>
  AOS.init({
    duration: 800,
    once: true
  });
</script>
