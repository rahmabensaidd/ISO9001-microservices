<div class="row">
  <!-- Success message -->
  <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>

  <!-- Error message -->
  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

  <!-- Buttons for generating reports -->
  <div class="col-lg-12 mb-4">
    <button class="btn btn-info me-2" (click)="generateRecruitmentReportPDF()">Generate PDF Report</button>
    <button class="btn btn-success" (click)="generateRecruitmentReportExcel()">Generate Excel Report</button>
  </div>

  <!-- Job offer selector for scoring -->
  <div class="col-lg-12 mb-4">
    <div class="form-group">
      <label for="jobOfferSelect">Select a job offer for scoring</label>
      <select
        id="jobOfferSelect"
        class="form-control"
        [(ngModel)]="selectedJobOfferId"
        (change)="loadSortedCandidates(selectedJobOfferId!)">
        <option [value]="null">Choose a job offer</option>
        <option *ngFor="let offer of jobOffers" [value]="offer.id">{{offer.title}}</option>
      </select>
    </div>
  </div>

  <!-- Sorted candidates table -->
  <div class="col-lg-12" *ngIf="selectedJobOfferId">
    <div class="card">
      <div class="card-body">
        <h4 class="card-title mb-4">Candidates Sorted by Score</h4>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
            <tr>
              <th>First Name</th>
              <th>Last Name</th>
              <th>Email</th>
              <th>Status</th>
              <th>Score (%)</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let candidate of sortedCandidates">
              <td>{{ candidate.firstName }}</td>
              <td>{{ candidate.lastName }}</td>
              <td>{{ candidate.email }}</td>
              <td>{{ candidate.status || 'Pending' }}</td>
              <td>{{ candidate.score ? (candidate.score * 100).toFixed(2) : 'N/A' }}%</td>
              <td>
                <button class="btn btn-success btn-sm me-2" (click)="acceptCandidate(candidate.id!)" [disabled]="candidate.status === 'Accepted'">
                  <i class="las la-check"></i> Accept
                </button>
                <button class="btn btn-danger btn-sm" (click)="rejectCandidate(candidate.id!)" [disabled]="candidate.status === 'Rejected'">
                  <i class="las la-times"></i> Reject
                </button>
              </td>
            </tr>
            <tr *ngIf="sortedCandidates.length === 0">
              <td colspan="6" class="text-center">No candidates found for this job offer</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Creation/editing form -->
  <div class="col-lg-12">
    <div class="card">
      <div class="card-body">
        <h4 class="card-title mb-4">{{ isEditing ? 'Edit a Job Offer' : 'Add a Job Offer' }}</h4>
        <form [formGroup]="jobOfferForm" (ngSubmit)="isEditing ? updateJobOffer() : createJobOffer()">
          <div class="form-group mb-3">
            <label for="title" class="form-label">Title</label>
            <input
              type="text"
              class="form-control"
              id="title"
              formControlName="title"
              placeholder="Job offer title"
            />
            <div *ngIf="f['title'].touched && f['title'].errors" class="text-danger">
              <div *ngIf="f['title'].errors['required']">The title is required.</div>
              <div *ngIf="f['title'].errors['minlength']">The title must be at least 3 characters long.</div>
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea
              class="form-control"
              id="description"
              formControlName="description"
              placeholder="Job offer description"
            ></textarea>
            <div *ngIf="f['description'].touched && f['description'].errors" class="text-danger">
              <div *ngIf="f['description'].errors['required']">The description is required.</div>
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="location">Location</label>
            <select
              id="location"
              formControlName="location"
              class="form-control"
              [ngClass]="{'is-invalid': f['location'].touched && f['location'].invalid}"
            >
              <option value="" disabled>Select a location</option>
              <option value="Tunis Sfax 10 RUE DE PENTHIEVRE 75008 PARIS">Tunis Sfax 10 RUE DE PENTHIEVRE 75008 PARIS</option>
              <option value="Tunis Ben Arous 10 RUE DE liberte 21008 mourouj">Tunis Ben Arous 10 RUE DE liberte 21008 mourouj</option>
            </select>
            <div *ngIf="f['location'].touched && f['location'].invalid" class="invalid-feedback">
              The location is required.
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="requirements" class="form-label">Requirements</label>
            <textarea
              class="form-control"
              id="requirements"
              formControlName="requirements"
              placeholder="Job offer requirements"
            ></textarea>
            <div *ngIf="f['requirements'].touched && f['requirements'].errors" class="text-danger">
              <div *ngIf="f['requirements'].errors['required']">The requirements are required.</div>
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="contractType" class="form-label">Contract Type</label>
            <select
              class="form-control"
              id="contractType"
              formControlName="contractType"
            >
              <option value="" disabled>Select a contract type</option>
              <option *ngFor="let type of contractTypes" [value]="type">{{ type }}</option>
            </select>
            <div *ngIf="f['contractType'].touched && f['contractType'].errors" class="text-danger">
              <div *ngIf="f['contractType'].errors['required']">The contract type is required.</div>
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="salary" class="form-label">Salary</label>
            <input
              type="number"
              class="form-control"
              id="salary"
              formControlName="salary"
              placeholder="Salary"
              step="0.01"
            />
            <div *ngIf="f['salary'].touched && f['salary'].errors" class="text-danger">
              <div *ngIf="f['salary'].errors['required']">The salary is required.</div>
              <div *ngIf="f['salary'].errors['min']">The salary must be greater than 0.</div>
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="skillsAndExpertise" class="form-label">Skills and Expertise</label>
            <textarea
              class="form-control"
              id="skillsAndExpertise"
              formControlName="skillsAndExpertise"
              placeholder="Required skills and expertise"
            ></textarea>
            <div *ngIf="f['skillsAndExpertise'].touched && f['skillsAndExpertise'].errors" class="text-danger">
              <div *ngIf="f['skillsAndExpertise'].errors['required']">The skills are required.</div>
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="workType" class="form-label">Work Type</label>
            <select
              class="form-control"
              id="workType"
              formControlName="workType"
            >
              <option value="" disabled>Select a work type</option>
              <option *ngFor="let type of workTypes" [value]="type">{{ type }}</option>
            </select>
            <div *ngIf="f['workType'].touched && f['workType'].errors" class="text-danger">
              <div *ngIf="f['workType'].errors['required']">The work type is required.</div>
            </div>
          </div>
          <button type="submit" class="btn btn-primary me-2" [disabled]="jobOfferForm.invalid">
            {{ isEditing ? 'Update' : 'Add' }}
          </button>
          <button type="button" class="btn btn-danger" (click)="resetForm()">
            Cancel
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- List of job offers -->
  <div class="col-lg-12">
    <div class="card mt-4">
      <div class="card-body">
        <h4 class="card-title mb-4">List of Job Offers</h4>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
            <tr>
              <th>Title</th>
              <th>Description</th>
              <th>Location</th>
              <th>Requirements</th>
              <th>Contract Type</th>
              <th>Salary</th>
              <th>Skills</th>
              <th>Work Type</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let offer of jobOffers">
              <td>{{ offer.title }}</td>
              <td>{{ offer.description }}</td>
              <td>{{ offer.location }}</td>
              <td>{{ offer.requirements }}</td>
              <td>{{ offer.contractType }}</td>
              <td>{{ offer.salary | currency:'TND' }}</td>
              <td>{{ offer.skillsAndExpertise }}</td>
              <td>{{ offer.workType }}</td>
              <td>
                <button class="btn btn-primary btn-sm me-2" (click)="editJobOffer(offer)">
                  <i class="las la-edit"></i> Edit
                </button>
                <button class="btn btn-danger btn-sm" (click)="deleteJobOffer(offer.id!)">
                  <i class="las la-trash-alt"></i> Delete
                </button>
              </td>
            </tr>
            <tr *ngIf="jobOffers.length === 0">
              <td colspan="9" class="text-center">No job offers found</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- List of candidates -->
  <div class="col-lg-12">
    <div class="card mt-4">
      <div class="card-body">
        <h4 class="card-title mb-4">List of Candidates</h4>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
            <tr>
              <th>First Name</th>
              <th>Last Name</th>
              <th>Email</th>
              <th>Gender</th>
              <th>Associated Job Offer</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let candidate of candidates">
              <td>{{ candidate.firstName }}</td>
              <td>{{ candidate.lastName }}</td>
              <td>{{ candidate.email }}</td>
              <td>{{ candidate.gender }}</td>
              <td>{{ getJobOfferTitle(candidate) }}</td>
              <td>{{ candidate.status || 'Pending' }}</td>
              <td>
                <button class="btn btn-success btn-sm me-2" (click)="acceptCandidate(candidate.id!)" [disabled]="candidate.status === 'Accepted'">
                  <i class="las la-check"></i> Accept
                </button>
                <button class="btn btn-danger btn-sm" (click)="rejectCandidate(candidate.id!)" [disabled]="candidate.status === 'Rejected'">
                  <i class="las la-times"></i> Reject
                </button>
              </td>
            </tr>
            <tr *ngIf="candidates.length === 0">
              <td colspan="7" class="text-center">No candidates found</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
