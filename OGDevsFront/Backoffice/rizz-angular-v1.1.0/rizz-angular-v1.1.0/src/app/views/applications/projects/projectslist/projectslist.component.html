<div class="container mt-4">
  <!-- Sélection du nombre d’éléments par page -->
  <div class="mb-3">
    <label for="itemsPerPage">Element number per page  :</label>
    <select class="form-select w-auto d-inline-block ms-2"
            [(ngModel)]="allprojects"
            (change)="onItemsPerPageChange()"
            id="itemsPerPage">
      <option [value]="2">2 items</option>
      <option [value]="4">4 items</option>
      <option [value]="6">6 items</option>
    </select>
  </div>
  <!-- Pagination -->
  <ngb-pagination
    [(page)]="page"
    [pageSize]="pageSize"
    [collectionSize]="collectionSize"
    (pageChange)="refreshProjects()"
    [maxSize]="5"
  >
  </ngb-pagination>
</div>



<div class="col-12 w-100" *ngFor="let project of projects">
    <div class="card project-card">
      <div class="position-absolute top-0 end-0 p-2 d-flex gap-2"
           *ngIf="project.responsable?.email === currentUserEmail">
        <!-- EDIT ICON -->
        <a href="javascript:void(0);"
           ngbTooltip="Edit Project"
           placement="bottom"
           (click)="updateProject(project)">
          <i class="las la-pen text-secondary fs-24"></i>
        </a>

        <!-- DELETE ICON -->
        <a href="javascript:void(0);"
           ngbTooltip="Delete Project"
           placement="bottom"
           (click)="deleteProject(project.idProjet)">
          <i class="las la-trash-alt text-secondary fs-24"></i>
        </a>

        <!-- START MANAGING ICON -->
        <a href="javascript:void(0);"
           ngbTooltip="Start Managing Project"
           placement="bottom"
           (click)="startManagingProject(project)">
          <i class="las la-play text-secondary fs-24"></i>
        </a>
      </div>

      <div class="card-body">
        <div class="section-content">
          <h3 class="fw-bold text-secondary ">
            {{ project.name }}
          </h3>
          <span class="badge bg-dark-green text-light mb-3">{{ project.projectType }}</span>
          <div class="row">
            <div class="col-md-6 mb-3">
              <p class="mb-2">
                <i class="las la-align-left me-2 fs-5 text-secondary"></i>
                <span class="text-muted fw-semibold">Description:</span> {{ project.description }}
              </p>
              <p class="mb-2">
                <i class="las la-calendar-plus me-2 fs-5 text-success"></i>
                <span class="text-muted fw-semibold">Start Date:</span> {{ project.start_Date | date:'mediumDate' }}

              </p>
              <p class="mb-2">
                <i class="las la-calendar-check me-2 fs-5 text-danger"></i>
                <span class="text-muted fw-semibold">End Date:</span> {{ project.expected_endDate }}
              </p>
              <p class="d-flex align-items-center gap-2 mb-0">
                <i class="las la-rocket fs-5 text-primary"></i>
                <span class="text-muted fw-semibold me-2">Status:</span>

                <ng-container *ngIf="isLaunched(project.start_Date); else notLaunched">
    <span class="badge bg-success-subtle text-success fw-semibold rounded-pill px-3 py-1">
      Launched {{ getDaysSince(project.start_Date) }} day{{ getDaysSince(project.start_Date) > 1 ? 's' : '' }} ago
    </span>
                </ng-container>

                <ng-template #notLaunched>
    <span class="badge bg-warning-subtle text-warning fw-semibold rounded-pill px-3 py-1">
      Not launched yet
    </span>
                </ng-template>
              </p>
                 <br/>
              <div class="team-container">
                <!-- Button to toggle team members -->
                <button class="btn btn-green btn-sm team-toggle-btn" (click)="toggleTeam(project)">
                  <i class="fas fa-users me-1"></i>
                  {{ project.showTeam ? 'Hide Team' : 'View Team' }}
                </button>

                <!-- Team members section -->
                <div *ngIf="project.showTeam" class="team-members mt-3 animate__animated animate__fadeIn">
                  <h6 class="text-green">Team Members</h6>
                  <ul class="list-group">
                    <li class="list-group-item d-flex align-items-center" *ngFor="let member of getTeamMembers(project)">
                      <i class="fas fa-user-check text-success me-2"></i>
                      <span><strong>{{ member.username }}</strong> <span class="email">{{ member.email }}</span></span>
                    </li>
                    <li class="list-group-item d-flex align-items-center" *ngIf="getTeamMembers(project).length === 0">
                      <i class="fas fa-exclamation-circle text-warning me-2"></i>
                      No team members assigned
                    </li>
                  </ul>
                </div>
              </div>

            </div>
            <div class="col-md-6 mb-3">
              <p class="mb-2">
                <i class="las la-user me-2 fs-5 text-info"></i>
                <span class="text-muted fw-semibold">Responsible:</span> {{ project.responsable?.username }}
              </p>
              <p class="mb-2">
                <i class="las la-envelope me-2 fs-5 text-warning"></i>
                <span class="text-muted fw-semibold email">Email:</span> {{ project.responsable?.email }}
              </p>


              <p class="mb-2">
                <i class="las la-user me-2 fs-5 text-info"></i>
                <span class="text-muted fw-semibold">Client:</span> {{ project.client?.username }}
              </p>
              <p class="mb-2 ">
                <i class="las la-envelope me-2 fs-5 text-warning"></i>
                <span class="text-muted fw-semibold email">Email:</span> {{ project.client?.email }}
              </p>




            </div>

          </div>
        </div>
        </div>
      </div>
    </div>

<!-- Modal de modification -->
<ng-template #editModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Edit Project</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <form>
      <div class="mb-3">
        <label class="form-label">Project Name</label>
        <input type="text" class="form-control" [(ngModel)]="selectedProject.name" name="name">
      </div>
      <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea class="form-control" rows="3" [(ngModel)]="selectedProject.description" name="description"></textarea>
      </div>
      <div class="mb-3">
        <label class="form-label">Start Date</label>
        <input type="date" class="form-control" [(ngModel)]="selectedProject.start_Date" name="start_Date">
      </div>
      <div class="mb-3">
        <label class="form-label">Expected End Date</label>
        <input type="date" class="form-control" [(ngModel)]="selectedProject.expected_endDate" name="expected_endDate">
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancel</button>
    <button type="button" class="btn btn-primary" (click)="saveChanges(modal)">Save</button>
  </div>
</ng-template>

